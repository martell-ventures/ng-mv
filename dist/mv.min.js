!function(){var a=angular.module("mv.billing",["mv.configuration","mv.widgets"]);a.factory("creditCards",[function(){function a(a){for(var b=!0,c=0,d=(a+"").split("").reverse(),e=0;e<d.length;e++){var f=parseInt(d[e],10);(b=!b)&&(f*=2),f>9&&(f-=9),c+=f}return c%10===0}var b=[{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,length:[15],cvcLength:[4],luhn:!0},{type:"visa",pattern:/^4/,length:[13,14,15,16],cvcLength:[3],luhn:!0}];return{fromNumber:function(a){var c;for(a=(a+"").replace(/\D/g,""),c=0;c<b.length;c++){var d=b[c];if(d.pattern.test(a))return d}return null},fromType:function(a){var c;for(c=0;c<b.length;c++){var d=b[c];if(d.type===a)return d}},numberValidForCard:function(b,c){var d=(c+"").replace(/\D/g,""),e=!1;return b.length.indexOf(d.length)>=0&&(e=b.luhn?a(d):!0),e},cvcValidForCard:function(a,b){var c=(b+"").replace(/\D/g,""),d=!1;return a.cvcLength.indexOf(c.length)>=0&&(d=!0),d}}}]),a.directive("creditCardCvv",["creditCards",function(a){return{restrict:"A",require:"?ngModel",scope:{cardNumber:"=creditCardCvv"},link:function(b,c,d,e){function f(a){if(a){var b=a.replace(/[^0-9]/g,"");return b!==a&&(e.$setViewValue(b),e.$render()),b}return void 0}e&&(e.$validators.validSecurityCode=function(d,e){var f=!1,g=a.fromNumber(b.cardNumber);return f=g&&a.cvcValidForCard(g,e)?!0:!1,c.prop("required")||(f=!0),f},e.$parsers.unshift(f),b.$watch(function(){return c.prop("required")},function(a){e.$validate()}),b.$watch("cardNumber",function(){var d=a.fromNumber(b.cardNumber);d?c.attr("maxLength",2==d.cvcLength.length?d.cvcLength[1]:d.cvcLength[0]):c.attr("maxLength",4),e.$validate()}))}}}]),a.directive("creditCardNumber",["creditCards",function(a){return{restrict:"A",require:"?ngModel",scope:{cardType:"=?"},link:function(b,c,d,e){function f(a){if(a){var b=a.replace(/[^0-9 ]/g,"");return b!==a&&(e.$setViewValue(b),e.$render()),b}return void 0}e&&(e.$validators.validCardNumber=function(d,e){var f=d||e,g=!1,h=a.fromNumber(f);if(h){b.cardType=h.type;var i=f.replace(/ /g,""),j=f.length-i.length;c.attr("minLength",h.length[0]+j),c.attr("maxLength",h.length[h.length.length-1]+j),a.numberValidForCard(h,f)&&(g=!0)}else b.cardType=void 0,c.attr("minLength",13),c.attr("maxLength",16);return c.prop("required")||(g=!0),g},e.$parsers.unshift(f),b.$watch(function(){return c.prop("required")},function(a){e.$validate()}))}}}]),a.directive("creditCardExpirationMonth",function(){return{restrict:"A",require:"?ngModel",scope:{expirationYear:"="},link:function(a,b,c,d){if(d){if("SELECT"==b.prop("tagName"))for(var e=["January","February","March","April","May","June","July","August","September","October","November","December"],f=0;f<e.length;f++){var g=f+1,h=angular.element('<option value="'+g+'">'+g+" - "+e[f]+"</option>");b.append(h)}d.$validators.validExpirationMonth=function(c,d){var e=c||d,f=!0;if(a.expirationYear){var g=parseInt(a.expirationYear),h=new Date,i=parseInt(e)-1;g==h.getFullYear()&&i<=h.getMonth()&&(f=!1)}return b.prop("required")||(f=!0),f},a.$watch("expirationYear",function(){d.$validate()}),a.$watch(function(){return b.prop("required")},function(a){d.$validate()})}}}}),a.directive("creditCardExpirationYear",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){if("SELECT"==b.prop("tagName"))for(var e=new Date,f=0;10>f;f++){var g=e.getFullYear()+f,h=angular.element('<option value="'+g+'">'+g+"</option>");b.append(h)}d.$validators.validExpirationYear=function(a,c){var d=a||c,e=new Date,f=parseInt(d),g=f<e.getFullYear()?!1:!0;return b.prop("required")||(g=!0),g},a.$watch(function(){return b.prop("required")},function(a){d.$validate()})}}}}),a.directive("creditCardInformation",["$mvConfiguration","creditCards",function(a,b){return{restrict:"E",templateUrl:function(b,c){var d="";return d=void 0!==c.templateUrl?c.templateUrl:a.templateBasePath+"credit-card-information.html"},scope:{cardholderName:"=",cardNumber:"=",cardType:"=?",expirationMonth:"=",expirationYear:"=",securityCode:"=",saveCard:"=?",cardRequired:"=?"},link:function(a,b,c){a.state={months:[],allowCardSave:void 0===a.saveCard?!1:!0,required:!0},a.$watch("cardRequired",function(b){a.state.required=void 0===b?!0:b})}}}])}(),function(){var a=angular.module("mv.configuration",[]);a.provider("$mvConfiguration",function(){var a={options:{templateBasePath:"defaultTemplatePath"},setTemplateBasePath:function(a){this.options.templateBasePath=a},$get:["$injector",function(a){var b={templateBasePath:this.options.templateBasePath};return b}]};return a})}(),function(){var a=angular.module("mv.filters",[]);a.filter("capitalize",function(){return function(a,b){return null!=a&&(a=a.toLowerCase()),a.substring(0,1).toUpperCase()+a.substring(1)}}),a.filter("max",function(){return function(a,b){a=a||"";var c=parseInt(a);return c>b&&(c=b),""+c}})}(),function(){var a=angular.module("mv.forms",["mv.configuration","mv.widgets"]);a.directive("postalCode",function(){return{require:"?ngModel",restrict:"A",scope:{countryCode:"=postalCode"},link:function(a,b,c,d){function e(a){if(a){var b=a.replace(/[^0-9 \-]/g,"");return b!==a&&(d.$setViewValue(b),d.$render()),b}return void 0}function f(c,d){var e=c||d,f=!1;if("US"==a.countryCode){var g=e.replace(/[^0-9]/g,"");f=9==g.length||5==g.length?!0:!1}else f=!0;return b.prop("required")||(f=!0),f}d&&(d.$validators.validUSZip=f,a.$watch("countryCode",function(a,c){if("US"==a)d.$parsers.unshift(e),b.prop("placeholder")&&b.prop("placeholder","Zip");else if(void 0!==a){b.prop("placeholder")&&b.prop("placeholder","Postal Code");var f=-1;angular.forEach(d.$parsers,function(a,b){a===e&&(f=b)}),f>=0&&d.$parsers.splice(f,1)}d.$validate()}),a.$watch(function(){return b.prop("required")},function(a){d.$validate()}))}}}),a.directive("mvAddress",["$http","$mvConfiguration",function(a,b){return{restrict:"E",templateUrl:function(a,c){var d="";return d=void 0!==c.templateUrl?c.templateUrl:b.templateBasePath+"address-elements.html"},scope:{street:"=",street2:"=?",city:"=",state:"=",zip:"=",country:"=",requiredFields:"=",useStreet2:"=?"},link:function(c,d,e){function f(a,b){var c=null;if(void 0!==a){var d=a.trim().toLowerCase();angular.forEach(b,function(a){(d==a.Abbreviation.toLowerCase()||d==a.Name.toLowerCase())&&(c=a)})}return c}c.countryObject={},c.countries=[],c.street||(c.street=""),c.useStreet2&&(c.street2||(c.street2="")),c.city||(c.city=""),c.state||(c.state=""),c.zip||(c.zip=""),c.state&&c.country&&(g[c.country]=c.state),c.$watch("countryObject",function(a){a&&a.Code!=c.country&&(c.country=a.Code,c.state=g[c.country]?g[c.country]:"")}),c.$watch("country",function(a){if(c.countryObject&&a!=c.countryObject.Code){var b=!1;angular.forEach(c.countries,function(d){d.Code==a&&(window.console.log("Change the country object!"),c.countryObject=d,b=!0)}),b||window.console.log("Change the country object; country "+a+" NOT FOUND!")}});var g={};c.$watch("state",function(a,b){a!==b&&(g[c.country]=a)}),c.stateRequired=function(){var a;return a="US"==c.country||"CA"==c.country?c.requiredFields&&c.requiredFields.state:!1},a.get(b.templateBasePath+"countries.json").success(function(a){c.countries=a,void 0===c.country&&(c.country="US"),angular.forEach(c.countries,function(a){if(a.Code==c.country&&(c.countryObject=a,a.States)){var b=f(c.state,a.States);b&&(c.state=b.Abbreviation)}})})}}}])}(),function(){var a=angular.module("mv.upload.button",["ui.bootstrap"]);a.directive("mvInlineUploadButton",["$q","$http","$parse",function(a,b,c){return{restrict:"A",scope:!0,link:function(d,e,f){function g(){var a=e.find("input[type=file]");a.wrap("<form>").closest("form").get(0).reset(),a.unwrap()}function h(){return a(function(a,c){b.post(f.endpointUrl,{verb:"upload-complete",id:f.identifier,bucket:j.uploadBucket,key:j.uploadKey,type:f.type,mimeType:j.mimeType}).then(function(b){b.data.success?a(b.data):(alert(b.data.message),c())},c)})}function i(){return a(function(a,b){var c=new FormData;for(var f in j.uploadParameters)c.append(f,j.uploadParameters[f]);c.append("success_action_status",201);var g=e.find("input[type=file]").get(0).files[0];c.append("file",g);var h=new XMLHttpRequest;h.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);m&&b!=m(d)&&d.$apply(function(){m.assign(d,b)})}},!1),h.addEventListener("load",function(c){d.$apply(c&&201==c.currentTarget.status?function(){n&&n.assign(d,!1),a()}:function(){n&&n.assign(d,!1),b({reason:"loadFailed",evt:c.currentTarget})})},!1),h.addEventListener("error",function(a){d.$apply(function(){n&&n.assign(d,!1),b({reason:"error",evt:a})})},!1),h.addEventListener("abort",function(a){d.$apply(function(){n&&n.assign(d,!1),b({reason:"aborted"})})},!1),n&&n.assign(d,!0),m&&m.assign(d,0),h.open("POST",j.postURL,!0),h.send(c)})}e.addClass("upload_button"),e.append('<input type="file" accept="'+f.accept+'">');var j=null,k=null,l=null,m=null,n=null;f.previewImageSrc&&(k=c(f.previewImageSrc)),f.onCompletion&&(l=c(f.onCompletion)),f.uploadProgress&&(m=c(f.uploadProgress)),f.uploading&&(n=c(f.uploading)),e.find("input[type=file]").on("change",function(){if($(this).val()){var a=this.files?this.files:[];if(a.length){{var c=$(this).val();f.identifier}if(c){var e=a[0].name,m=a[0].type,n=f.accept.split("/"),o=m.split("/"),p=!0;if(n.length==o.length)for(var q=0;q<n.length;q++)n[q]!=o[q]&&"*"!=n[q]&&(p=!1);if(p){if(window.FileReader)if(/^image/.test(m)){var r=new FileReader;r.readAsDataURL(a[0]),r.onloadend=function(){var a=this.result;d.$apply(function(){k.assign(d,a)})}}else f.defaultPreviewImage&&k.assign(d,f.defaultPreviewImage);b.post(f.endpointUrl,{verb:"upload-parameters",filename:e,id:f.identifier,type:f.type,mimeType:m}).then(function(a){a.data.success?(j={postURL:a.data.result.url,uploadBucket:a.data.result.bucket,uploadParameters:a.data.result.params,uploadKey:a.data.result.params.key,mimeType:a.data.result.mimeType},i().then(function(a){h().then(function(a){l&&l(d,{bucket:a.result.bucket,key:a.result.key,url:a.result.url}),g()})},function(a){switch(a.reason){case"loadFailed":alert("There was an error attempting to upload the file."+a.evt.response);break;case"error":alert("There was an error attempting to upload the file."+a.evt.response);break;case"aborted":alert("The upload has been canceled by the user or the browser dropped the connection.")}g()})):(alert(a.data.message),g())})}else{var s="Invalid file type!";if(n.length)switch(n[0]){case"video":s="The selected file is not a valid video file.";break;case"image":s="The selected file is not a valid image file.";break;case"audio":s="The selected file is not a valid audio file."}alert(s),g()}}}}})}}}]),a.directive("mvUploadButtonWithProgress",["$q","$http",function(a,b){return{restrict:"E",scope:{title:"@",accept:"@",type:"@",identifier:"@",endpointUrl:"@",previewImageSrc:"=?",onCompletion:"&?"},template:'<div><progressbar ng-show="state.uploading" style="width: 100%;" value="state.progress"></progressbar><span ng-show="!state.uploading" class="btn btn-file btn-default btn-sm" mv-inline-upload-button type="{{ type }}" accept="{{ accept }}" identifier="{{ identifier }}" endpoint-url="{{ endpointUrl }}" preview-image-src="state.previewImageSrc" on-completion="complete(bucket, key, url)" upload-progress="state.progress" uploading="state.uploading" >{{ title }}</span></div>',link:function(a,b,c){a.state={uploading:!1,progress:0,previewImageSrc:null},a.$watch("state.previewImageSrc",function(b){a.previewImageSrc&&(a.previewImageSrc=b)}),a.complete=function(b,c,d){a.onCompletion&&a.onCompletion({bucket:b,key:c,url:d})}}}}])}(),function(){var a=angular.module("mv.utils",["mv.filters","mv.configuration","ui.bootstrap"]);a.directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b==a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}}),a.service("Dialogs",["$modal","$sce","$mvConfiguration",function(a,b,c){this.Confirm=function(d,e,f){return a.open({controller:["$scope","$modalInstance","message","title","buttons",function(a,c,d,e,f){a.message=b.trustAsHtml(d),a.title=e,a.buttons=f,a.clickButton=function(a){"cancel"==a.type?c.dismiss(a.name):c.close(a)}}],templateUrl:c.templateBasePath+"dialogs/confirm-modal.html",resolve:{message:function(){return d},buttons:function(){return void 0===f?[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]:f},title:function(){return void 0===e?"Confirm":e}}}).result},this.SingleTextAreaEntry=function(d,e,f){return a.open({controller:["$scope","$modalInstance","$mvConfiguration","message","title","buttons",function(a,c,d,e,f,g){a.message=b.trustAsHtml(e),a.title=f,a.buttons=g,a.params={textAreaEntry:""},a.clickButton=function(b){"cancel"==b.type?c.dismiss(b.name):c.close({button:b,textAreaEntry:a.params.textAreaEntry})}}],templateUrl:c.templateBasePath+"dialogs/single-text-area-modal.html",resolve:{message:function(){return d},buttons:function(){return void 0===f?[{name:"OK",type:"ok"},{name:"Cancel",type:"cancel"}]:f},title:function(){return void 0===e?"Confirm":e}}}).result}}]),a.service("UtilService",function(){this.CalculateTimeDeltas=function(a,b){var c=new Date,d=null,e=null;b&&(b instanceof Date?d=b:"0000-00-00"!=b&&(d=Date.parse(b))),e=a?a instanceof Date?a:Date.parse(a):c;var f={days:0,hours:0,minutes:0,seconds:0,timeUnits:"",timeValue:""};if(null!=d){var g=c>e?c:e;if(d>g){var h=Math.abs(d-g)/1e3,i=Math.floor(h/86400);h-=86400*i;var j=Math.floor(h/3600)%24;h-=3600*j;var k=Math.floor(h/60)%60;h-=60*k;var l=h%60;f.days=i,f.hours=j,f.minutes=k,f.seconds=l,i>0?(f.timeValue=i,f.timeUnits=1==i?"day left":"days left"):j>0?(f.timeValue=j,f.timeUnits=1==j?"hour left":"hours left"):k>0?(f.timeValue=k,f.timeUnits=1==k?"minute left":"minutes left"):l>0&&(f.timeValue=l,f.timeUnits=1==l?"second left":"seconds left")}else f.timeValue=""}else f.timeValue="Unknown",f.timeUnits="days left";return f}}),a.directive("onlyDigits",function(){return{restrict:"EA",require:"?ngModel",link:function(a,b,c,d){d&&d.$parsers.unshift(function(a){var b=!1,e=a.split("").filter(function(a,d){var e=!isNaN(a)&&" "!=a;return!e&&c.allowDecimal&&"true"==c.allowDecimal&&"."==a&&b===!1&&(b=!0,e=!0),!e&&c.allowNegative&&"true"==c.allowNegative&&(e="-"==a&&0===parseInt(d)),e}).join("");return c.maxNum&&!isNaN(c.maxNum)&&parseFloat(e)>parseFloat(c.maxNum)&&(e=c.maxNum),c.minNum&&!isNaN(c.minNum)&&parseFloat(e)<parseFloat(c.minNum)&&(e=c.minNum),d.$setViewValue(e),d.$render(),e})}}}),a.directive("onlyNumber",function(){return{require:"ngModel",restrict:"AC",link:function(a,b,c,d){function e(a){if(a){var b=a.replace(/[^0-9]/g,"");return b!==a&&(d.$setViewValue(b),d.$render()),parseInt(b,10)}return void 0}d.$parsers.push(e)}}}),a.directive("thousandsComma",["$filter",function(a){return{require:"?ngModel",link:function(b,c,d,e){function f(b){var d,e;return""!==b?(e=b.replace(/[\,\.]/g,""),d=a("number")(e),c.val(d)):(d="",e=""),c.val(d),e}function g(a){if(a){var b=a.replace(/[^0-9\,]/g,"");return b!==a&&(e.$setViewValue(b),e.$render()),b}return void 0}e&&(e.$formatters.unshift(function(){return""!==e.$modelValue?a("number")(e.$modelValue):""}),e.$parsers.unshift(f),e.$parsers.unshift(g))}}}]),/**
		 * angular-elastic-input
		 * A directive for AngularJS which automatically resizes the width of input field according to the content, while typing.
		 * @author: Jacek Pulit <jacek.pulit@gmail.com>
		 * @license: MIT License
		 */
a.directive("mvElasticInput",function(){return{require:"?ngModel",restrict:"A",link:function(a,b,c,d){function e(){g.text(c.placeholder?b.val()||c.placeholder:b.val()),b.css("width",g.outerWidth()+1)}var f=angular.element('<div style="position:fixed; top:-999px; left:0;"></div>'),g=angular.element('<span style="white-space:pre;"></span>'),h="none"===b.css("maxWidth")?b.parent().innerWidth():b.css("maxWidth");b.css("minWidth",c.mvElasticInputMinwidth||b.css("minWidth")),b.css("maxWidth",c.mvElasticInputMaxwidth||h),angular.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderRightWidth","borderLeftWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(a){g.css(a,b.css(a))}),angular.element("body").append(f.append(g)),e(),d?a.$watch(c.ngModel,function(){e()}):b.on("keydown keyup focus input propertychange change",function(){e()})}}})}(),function(){var a=angular.module("mv.widgets",[]);a.directive("showValidationIcon",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){function e(a,b){a?b?(f.removeClass("has-error").addClass("has-success"),void 0!==g&&g.removeClass("hidden").removeClass("glyphicon-remove").addClass("glyphicon-ok")):(f.removeClass("has-success").addClass("has-error"),void 0!==g&&g.removeClass("hidden").removeClass("glyphicon-ok").addClass("glyphicon-remove")):(f.removeClass("has-success").removeClass("has-error"),void 0!==g&&g.addClass("hidden"))}if(d){var f=b.parents(".form-group:first");f&&f.addClass("has-feedback");var g;"INPUT"==b.prop("tagName")&&(g=angular.element('<span class=" form-control-feedback glyphicon glyphicon-ok hidden"></span>'),b.after(g)),a.$watch(function(){return d.$dirty+"-"+d.$valid+"-"+d.$touched},function(){var a=d.$dirty||d.$touched;e(a,d.$valid)})}}}}),a.directive("flashAlert",["$timeout",function(a){return{restrict:"E",scope:{type:"=",message:"=",duration:"=?"},template:'<div ng-show="visible" class="alert" ng-class="alertClass"><button type="button" class="close" ng-click="visible= false">x</button><strong>{{ strongText }}</strong><span ng-bind-html="message"></span></div>',link:function(b,c,d){b.$watch("type",function(){if(b.type)switch(b.type){case"info":b.alertClass="alert-info",b.strongText="";break;case"warning":b.alertClass="alert-warning",b.strongText="Warning:";break;case"error":b.alertClass="alert-danger",b.strongText="Error:";break;case"success":b.alertClass="alert-success",b.strongText=""}}),b.$watch("message",function(){if(b.message){var c=b.duration||5e3;a(function(){b.visible=!1},c),b.visible=!0}})}}}]),a.directive("itemExpander",function(){return{restrict:"E",transclude:!0,scope:{title:"@",expanded:"=?"},template:'<h4><a href="#" ng-click="toggle($event)"><span class="glyphicon" ng-class="iconClass"></span>{{ title }}</a></h4><div ng-show="expanded"><ng-transclude></ng-transclude></div>',link:function(a,b,c){a.toggle=function(b){b.preventDefault(),a.expanded=!a.expanded},a.$watch("expanded",function(b){a.iconClass=b?"glyphicon-collapse-down":"glyphicon-collapse-up"})}}}),a.directive("audioPlayer",function(){return{restrict:"E",link:function(a,b,c){c.audioUrl?(b.append('<div id="'+c.containerId+'">Loading the player...</div>'),jwplayer(c.containerId).setup({file:c.audioUrl,supplied:"mp3",width:"100%",height:30})):b.append('<p class="text-center h4">This audio is still processing on the server.<br/>Please refresh this page in a few minutes.</p>')}}}),a.directive("videoPlayer",function(){return{restrict:"E",link:function(a,b,c){c.videoUrl?(b.append('<div id="'+c.containerId+'">Loading the player...</div>'),jwplayer(c.containerId).setup({file:c.videoUrl,image:c.imageUrl,width:"100%",aspectratio:c.width+":"+c.height,stretching:"exactfit"})):b.append('<p class="text-center h4">This video is still processing on the server.<br/>Please refresh this page in a few minutes to view.</p>')}}})}();